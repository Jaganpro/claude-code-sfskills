<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <!--
    Flow: Account_Create_Primary_Contact
    Type: Record-Triggered (After Save - Create Only)
    Purpose: Automatically creates a primary Contact when a new Account is created

    Design Notes:
    - Triggers ONLY on Account creation (not updates)
    - Creates one Contact per Account with basic field mapping
    - Uses $Record to access Account fields directly (no query needed)
    - Includes fault path for error handling

    Field Mapping:
    - Contact.LastName = Account.Name
    - Contact.AccountId = Account.Id
    - Contact.Phone = Account.Phone (if available)
    - Contact.Description = "Primary contact auto-created from Account"

    API Version: 62.0 (Winter '26)
    -->

    <apiVersion>62.0</apiVersion>

    <!-- Error Handler Assignment -->
    <assignments>
        <name>Handle_Error</name>
        <label>Handle Error</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <assignmentItems>
            <assignToReference>var_ErrorMessage</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.FaultMessage</elementReference>
            </value>
        </assignmentItems>
    </assignments>

    <description>Automatically creates a primary Contact when a new Account is created. Maps Account Name to Contact LastName and links the Contact to the Account.</description>

    <label>Account - Create Primary Contact</label>

    <processType>AutoLaunchedFlow</processType>

    <!-- Create Contact Record -->
    <recordCreates>
        <name>Create_Primary_Contact</name>
        <label>Create Primary Contact</label>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <faultConnector>
            <targetReference>Handle_Error</targetReference>
        </faultConnector>
        <inputAssignments>
            <field>AccountId</field>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Description</field>
            <value>
                <stringValue>Primary contact auto-created from Account</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>LastName</field>
            <value>
                <elementReference>$Record.Name</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Phone</field>
            <value>
                <elementReference>$Record.Phone</elementReference>
            </value>
        </inputAssignments>
        <object>Contact</object>
    </recordCreates>

    <!-- Trigger Configuration: Account Create Only -->
    <start>
        <locationX>0</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Create_Primary_Contact</targetReference>
        </connector>
        <object>Account</object>
        <recordTriggerType>Create</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>

    <status>Active</status>

    <!-- Variables -->
    <variables>
        <name>var_ErrorMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>

</Flow>
